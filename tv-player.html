<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>zhrçš„IPTVç›´æ’­</title>
    <meta name="description" content="åŠ¨æ€IPTVç›´æ’­åˆ—è¡¨">
    <link rel="icon" href="https://s41.ax1x.com/2025/12/07/pZnSiid.png" type="image/png">
    <style>
        :root {
            --ghost-accent-color: #59c090;
            --text-color: #333;
            --bg-color: #fff;
            --light-gray: #f5f5f5;
            --border-color: #eaeaea;
            --font-serif: 'Noto Serif SC', serif;
            --font-sans: 'Noto Sans SC', sans-serif;
            --test-color: #ff6b6b;
            --nav-color: #4a90e2;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: var(--font-sans); color: var(--text-color); background-color: var(--bg-color); line-height: 1.6; display: flex; flex-direction: column; min-height: 100vh; }
        a { text-decoration: none; color: inherit; transition: color 0.3s; }
        a:hover { color: var(--ghost-accent-color); }
        img { max-width: 100%; height: auto; }
        .container { max-width: 1400px; margin: 0 auto; padding: 0 20px; width: 100%; }
        
        /* å¤´éƒ¨ */
        header {
            position: sticky; top: 0; background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); z-index: 100; border-bottom: 1px solid var(--border-color);
        }
        .header-inner { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; }
        .logo { display: flex; align-items: center; }
        .logo img { width: 40px; height: 40px; border-radius: 50%; margin-right: 10px; }
        .logo-text { font-weight: bold; font-size: 1.2rem; }
        nav ul { display: flex; list-style: none; align-items: center; }
        nav li { margin-left: 25px; }
        nav a { font-size: 0.9rem; font-weight: 500; }
        .back-btn { background: none; border: none; cursor: pointer; font-size: 1.2rem; color: var(--text-color); width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.3s; }
        .back-btn:hover { background: var(--light-gray); }
        
        /* ä¸»è¦å†…å®¹åŒº - ä¸¤æ å¸ƒå±€ */
        .main-content { padding: 30px 0; flex: 1; }
        .tv-layout { display: flex; gap: 30px; }
        
        /* å·¦ä¾§æ’­æ”¾å™¨ */
        .player-section { flex: 3; min-width: 0; }
        .tv-player-container {
            position: relative; width: 100%; border-radius: 12px; overflow: hidden; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); background-color: #000; margin-bottom: 20px;
        }
        #hunanTVPlayer { 
            width: 100%; 
            height: 500px; 
            background-color: #000; 
            /* éšè—æµè§ˆå™¨åŸç”Ÿæ§åˆ¶å™¨ */
            &::-webkit-media-controls { display: none !important; }
            &::-webkit-media-controls-enclosure { display: none !important; }
            &::-webkit-media-controls-panel { display: none !important; }
            &::-webkit-media-controls-play-button { display: none !important; }
            &::-webkit-media-controls-timeline { display: none !important; }
            &::-webkit-media-controls-current-time-display { display: none !important; }
            &::-webkit-media-controls-time-remaining-display { display: none !important; }
            &::-webkit-media-controls-timeline-container { display: none !important; }
            &::-webkit-media-controls-volume-slider-container { display: none !important; }
            &::-webkit-media-controls-volume-slider { display: none !important; }
            &::-webkit-media-controls-mute-button { display: none !important; }
            &::-webkit-media-controls-toggle-closed-captions-button { display: none !important; }
            &::-webkit-media-controls-fullscreen-button { display: none !important; }
        }
        
        /* è‡ªå®šä¹‰æ§åˆ¶æ¡ */
        .custom-controls {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: opacity 0.3s;
            z-index: 5;
        }
        
        .controls-left, .controls-center, .controls-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .control-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s;
            backdrop-filter: blur(5px);
        }
        
        .control-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }
        
        .control-btn.nav-btn {
            background: rgba(74, 144, 226, 0.7);
        }
        
        .control-btn.nav-btn:hover {
            background: rgba(74, 144, 226, 0.9);
        }
        
        .control-btn.test-btn {
            background: rgba(255, 107, 107, 0.7);
        }
        
        .control-btn.test-btn:hover {
            background: rgba(255, 107, 107, 0.9);
        }
        
        .quality-selector {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            backdrop-filter: blur(5px);
            min-width: 100px;
        }
        
        .quality-selector option {
            background: #333;
            color: white;
        }
        
        .progress-container {
            flex: 1;
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            margin: 0 15px;
            cursor: pointer;
            position: relative;
        }
        
        .progress-bar {
            height: 100%;
            background: var(--ghost-accent-color);
            border-radius: 2px;
            width: 0%;
            position: relative;
        }
        
        .progress-time {
            position: absolute;
            top: -25px;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            display: none;
        }
        
        .progress-container:hover .progress-time {
            display: block;
        }
        
        .volume-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .volume-slider {
            width: 80px;
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            cursor: pointer;
            position: relative;
        }
        
        .volume-level {
            height: 100%;
            background: white;
            border-radius: 2px;
            width: 70%;
        }
        
        /* æ§åˆ¶æŒ‰é’®åŒºåŸŸ */
        .tv-controls { display: flex; justify-content: center; flex-wrap: wrap; gap: 10px; margin-top: 15px; }
        .tv-control-btn { background: var(--ghost-accent-color); border: none; color: white; padding: 10px 20px; border-radius: 30px; font-size: 0.95rem; cursor: pointer; display: flex; align-items: center; gap: 6px; transition: all 0.3s; }
        .tv-control-btn:hover { background: #4aad7a; transform: translateY(-2px); }
        .test-btn { background: var(--test-color); }
        .test-btn:hover { background: #ff5252; }
        .current-channel-info { margin-top: 15px; padding: 15px; background: var(--light-gray); border-radius: 8px; }
        .current-channel-info h3 { font-family: var(--font-serif); margin-bottom: 5px; color: var(--text-color); }
        .current-channel-info p { color: #666; font-size: 0.9rem; }
        .test-indicator { color: var(--test-color); font-weight: bold; }
        
        /* å³ä¾§é¢‘é“åˆ—è¡¨ */
        .channels-section { flex: 2; min-width: 0; max-width: 450px; }
        .channels-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .channels-title { font-size: 1.5rem; font-family: var(--font-serif); color: var(--text-color); display: flex; align-items: center; }
        .channels-title::before { content: ""; display: inline-block; width: 6px; height: 24px; background: var(--ghost-accent-color); margin-right: 12px; border-radius: 3px; }
        .category-filter { padding: 8px 15px; border: 1px solid var(--border-color); border-radius: 20px; background: white; font-size: 0.9rem; color: var(--text-color); cursor: pointer; }
        .channels-list { height: 600px; overflow-y: auto; padding-right: 5px; }
        
        /* é¢‘é“é¡¹ç›®æ ·å¼ */
        .channel-item {
            display: flex; align-items: center; background: var(--bg-color); border-radius: 10px; padding: 12px 15px; margin-bottom: 12px; border: 1px solid var(--border-color); cursor: pointer; transition: all 0.3s;
        }
        .channel-item:hover { border-color: var(--ghost-accent-color); box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05); transform: translateY(-2px); }
        .channel-item.active { border-color: var(--ghost-accent-color); background-color: rgba(89, 192, 144, 0.05); }
        .channel-logo { width: 50px; height: 50px; border-radius: 8px; overflow: hidden; flex-shrink: 0; margin-right: 15px; background-color: #f0f0f0; }
        .channel-logo img { width: 100%; height: 100%; object-fit: cover; }
        .channel-info { flex: 1; min-width: 0; }
        .channel-name { font-size: 1rem; font-weight: 600; margin-bottom: 4px; color: var(--text-color); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .channel-group { font-size: 0.85rem; color: #888; display: inline-block; background: var(--light-gray); padding: 2px 10px; border-radius: 12px; }
        
        /* åŠ è½½å’Œé”™è¯¯çŠ¶æ€ */
        .loading-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; z-index: 10; border-radius: 12px;
        }
        .loading-spinner { width: 40px; height: 40px; border: 4px solid rgba(255, 255, 255, 0.3); border-radius: 50%; border-top-color: var(--ghost-accent-color); animation: spin 1s ease-in-out infinite; margin-bottom: 15px; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .hidden { display: none !important; }
        
        /* é¡µè„š */
        footer { background: var(--light-gray); padding: 40px 0; margin-top: auto; border-top: 1px solid var(--border-color); }
        .footer-inner { display: flex; justify-content: space-between; align-items: center; }
        .powered-by { color: #888; font-size: 0.9rem; }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1100px) {
            .tv-layout { flex-direction: column; }
            .channels-section { max-width: 100%; }
            #hunanTVPlayer { height: 400px; }
            .channels-list { height: 400px; }
        }
        @media (max-width: 768px) {
            .header-inner { flex-direction: column; align-items: flex-start; }
            nav ul { margin-top: 15px; flex-wrap: wrap; }
            nav li { margin: 5px 15px 5px 0; }
            #hunanTVPlayer { height: 300px; }
            .channels-list { height: 350px; }
            .footer-inner { flex-direction: column; text-align: center; }
            .tv-controls { flex-direction: column; align-items: center; }
            .tv-control-btn { width: 100%; justify-content: center; }
            .custom-controls { flex-direction: column; gap: 10px; padding: 10px; }
            .controls-left, .controls-center, .controls-right { width: 100%; justify-content: center; }
            .progress-container { margin: 10px 0; }
            .quality-selector { min-width: 80px; }
        }
        @media (max-width: 480px) {
            #hunanTVPlayer { height: 250px; }
            .channel-item { padding: 10px; }
            .channel-logo { width: 40px; height: 40px; margin-right: 10px; }
            .control-btn { width: 36px; height: 36px; }
            .quality-selector { padding: 6px 10px; font-size: 0.8rem; }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-inner">
                <div class="logo">
                    <img src="https://s41.ax1x.com/2025/12/06/pZmaGuR.png" alt="zhr">
                    <span class="logo-text">zhrçš„IPTVç›´æ’­</span>
                </div>
                <nav>
                    <ul>
                        <li><a href="index.html">è¿”å›åšå®¢</a></li>
                    </ul>
                </nav>
                <div class="header-actions">
                    <button class="back-btn" onclick="window.location.href='index.html'">â†</button>
                </div>
            </div>
        </div>
    </header>

    <main class="main-content container">
        <div class="tv-layout">
            <!-- å·¦ä¾§æ’­æ”¾å™¨ -->
            <section class="player-section">
                <div class="tv-player-container">
                    <div class="loading-overlay" id="loadingOverlay">
                        <div class="loading-spinner"></div>
                        <p>æ­£åœ¨åŠ è½½ç›´æ’­æµ...</p>
                    </div>
                    <video id="hunanTVPlayer" autoplay playsinline>
                        æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒHTML5è§†é¢‘æ’­æ”¾ï¼Œè¯·ä½¿ç”¨ç°ä»£æµè§ˆå™¨è§‚çœ‹
                    </video>
                    
                    <!-- è‡ªå®šä¹‰æ§åˆ¶æ¡ -->
                    <div class="custom-controls" id="customControls">
                        <div class="controls-left">
                            <button class="control-btn" id="customPlayBtn">
                                <span id="playIcon">âšâš</span>
                            </button>
                            <button class="control-btn nav-btn" id="prevBtn">â—€</button>
                            <button class="control-btn nav-btn" id="nextBtn">â–¶</button>
                            <div class="volume-container">
                                <button class="control-btn" id="volumeBtn">ğŸ”Š</button>
                                <div class="volume-slider" id="volumeSlider">
                                    <div class="volume-level" id="volumeLevel"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="controls-center">
                            <div class="progress-container" id="progressContainer">
                                <div class="progress-bar" id="progressBar"></div>
                                <div class="progress-time" id="progressTime">00:00</div>
                            </div>
                        </div>
                        
                        <div class="controls-right">
                            <select class="quality-selector" id="qualitySelector">
                                <option value="auto">è‡ªåŠ¨æ¸…æ™°åº¦</option>
                            </select>
                            <button class="control-btn test-btn" id="testBtn1" title="æµ‹è¯•è§†é¢‘1">ğŸ”§1</button>
                            <button class="control-btn test-btn" id="testBtn2" title="æµ‹è¯•è§†é¢‘2">ğŸ”§2</button>
                            <button class="control-btn" id="fullscreenBtn">â›¶</button>
                        </div>
                    </div>
                </div>
                
                <div class="current-channel-info">
                    <h3 id="currentChannelName">æ¹–å—å«è§†</h3>
                    <p id="currentChannelGroup">å«è§† Â· å½“å‰æ­£åœ¨æ’­æ”¾</p>
                </div>
            </section>
            
            <!-- å³ä¾§é¢‘é“åˆ—è¡¨ -->
            <section class="channels-section">
                <div class="channels-header">
                    <h2 class="channels-title">ç›´æ’­é¢‘é“</h2>
                    <select class="category-filter" id="categoryFilter">
                        <option value="å…¨éƒ¨">å…¨éƒ¨åˆ†ç±»</option>
                    </select>
                </div>
                <div class="channels-list" id="channelsList">
                    <!-- é¢‘é“åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    <div class="loading-overlay" style="position: relative; height: 100px; background: transparent; color: var(--text-color);">
                        <div class="loading-spinner" style="border-top-color: var(--ghost-accent-color);"></div>
                        <p>æ­£åœ¨åŠ è½½é¢‘é“åˆ—è¡¨...</p>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <footer>
        <div class="container">
            <div class="footer-inner">
                <div class="powered-by">é¢‘é“åˆ—è¡¨åŠ¨æ€åŠ è½½è‡ª M3U æ–‡ä»¶</div>
            </div>
        </div>
    </footer>

    <script>
        // é…ç½®
        const M3U_URL = 'https://raw.bgithub.xyz/zhr-0731/IPTV-m3u/refs/heads/main/index.m3u';
        const TEST_VIDEO_URL_1 = 'http://devimages.apple.com.edgekey.net/streaming/examples/bipbop_4x3/gear2/prog_index.m3u8';
        const TEST_VIDEO_URL_2 = 'https://demo.unified-streaming.com/k8s/features/stable/video/tears-of-steel/tears-of-steel.ism/.m3u8';
        
        // å…¨å±€å˜é‡
        let allChannels = [];
        let currentChannelIndex = 7; // é»˜è®¤é€‰ä¸­æ¹–å—å«è§†ï¼ˆæ ¹æ®åˆ—è¡¨ä½ç½®ï¼‰
        let player = null;
        let isPlayingTestVideo = false;
        let lastPlayedChannel = null; // è®°å½•ä¸Šæ¬¡æ’­æ”¾çš„é¢‘é“ï¼Œæ–¹ä¾¿åˆ‡æ¢å›æ¥
        let controlsHideTimeout = null;
        
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–æ’­æ”¾å™¨å’ŒUI
            player = document.getElementById('hunanTVPlayer');
            initPlayerControls();
            loadChannelList();
            
            // åˆå§‹åŒ–é»˜è®¤æ’­æ”¾æ¹–å—å«è§†
            setTimeout(() => {
                const defaultChannel = allChannels[currentChannelIndex];
                if (defaultChannel) {
                    playChannel(defaultChannel);
                    lastPlayedChannel = defaultChannel;
                }
            }, 1000);
        });
        
        // è§£æM3Uæ–‡ä»¶å†…å®¹
        async function parseM3U(content) {
            const channels = [];
            const lines = content.split('\n');
            let currentChannel = null;
            let categories = new Set(['å…¨éƒ¨']);
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                
                if (line.startsWith('#EXTINF:')) {
                    currentChannel = {
                        name: '',
                        logo: '',
                        url: '',
                        group: 'å…¶ä»–'
                    };
                    
                    // è§£æé¢‘é“ä¿¡æ¯
                    const tvgLogoMatch = line.match(/tvg-logo="([^"]+)"/);
                    if (tvgLogoMatch) currentChannel.logo = tvgLogoMatch[1];
                    
                    const groupMatch = line.match(/group-title="([^"]+)"/);
                    if (groupMatch) {
                        currentChannel.group = groupMatch[1];
                        categories.add(groupMatch[1]);
                    }
                    
                    const nameMatch = line.match(/,(.+)$/);
                    if (nameMatch) currentChannel.name = nameMatch[1].trim();
                }
                else if (line && !line.startsWith('#') && currentChannel) {
                    currentChannel.url = line.trim();
                    if (currentChannel.name && currentChannel.url) {
                        channels.push(currentChannel);
                    }
                    currentChannel = null;
                }
            }
            
            return { channels, categories: Array.from(categories) };
        }
        
        // åŠ è½½é¢‘é“åˆ—è¡¨
        async function loadChannelList() {
            try {
                const response = await fetch(M3U_URL);
                const content = await response.text();
                const { channels, categories } = await parseM3U(content);
                
                allChannels = channels;
                
                // æ›´æ–°åˆ†ç±»ç­›é€‰å™¨
                updateCategoryFilter(categories);
                
                // æ¸²æŸ“é¢‘é“åˆ—è¡¨
                renderChannelList('å…¨éƒ¨');
                
                console.log(`æˆåŠŸåŠ è½½ ${channels.length} ä¸ªé¢‘é“`);
            } catch (error) {
                console.error('åŠ è½½é¢‘é“åˆ—è¡¨å¤±è´¥:', error);
                document.getElementById('channelsList').innerHTML = 
                    '<div style="padding: 30px; text-align: center; color: #888;">åŠ è½½é¢‘é“åˆ—è¡¨å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•</div>';
            }
        }
        
        // æ›´æ–°åˆ†ç±»ç­›é€‰å™¨
        function updateCategoryFilter(categories) {
            const filter = document.getElementById('categoryFilter');
            categories.sort();
            
            categories.forEach(category => {
                if (category !== 'å…¨éƒ¨') {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    filter.appendChild(option);
                }
            });
            
            filter.addEventListener('change', function() {
                renderChannelList(this.value);
            });
        }
        
        // æ¸²æŸ“é¢‘é“åˆ—è¡¨
        function renderChannelList(category) {
            const channelsList = document.getElementById('channelsList');
            const filteredChannels = category === 'å…¨éƒ¨' 
                ? allChannels 
                : allChannels.filter(ch => ch.group === category);
            
            if (filteredChannels.length === 0) {
                channelsList.innerHTML = '<div style="padding: 30px; text-align: center; color: #888;">è¯¥åˆ†ç±»ä¸‹æš‚æ— é¢‘é“</div>';
                return;
            }
            
            let html = '';
            filteredChannels.forEach((channel, index) => {
                const originalIndex = allChannels.findIndex(ch => ch.url === channel.url);
                const isActive = originalIndex === currentChannelIndex && !isPlayingTestVideo;
                
                html += `
                    <div class="channel-item ${isActive ? 'active' : ''}" data-index="${originalIndex}">
                        <div class="channel-logo">
                            <img src="${channel.logo || 'https://via.placeholder.com/50x50/cccccc/969696?text=TV'}" alt="${channel.name}" onerror="this.src='https://via.placeholder.com/50x50/cccccc/969696?text=TV'">
                        </div>
                        <div class="channel-info">
                            <div class="channel-name">${channel.name}</div>
                            <span class="channel-group">${channel.group}</span>
                        </div>
                    </div>
                `;
            });
            
            channelsList.innerHTML = html;
            
            // æ·»åŠ ç‚¹å‡»äº‹ä»¶
            document.querySelectorAll('.channel-item').forEach(item => {
                item.addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    const channel = allChannels[index];
                    if (channel) {
                        playChannel(channel, index);
                    }
                });
            });
        }
        
        // æ’­æ”¾æŒ‡å®šé¢‘é“
        function playChannel(channel, index = null) {
            if (index !== null) {
                currentChannelIndex = index;
            }
            
            isPlayingTestVideo = false;
            lastPlayedChannel = channel;
            
            // æ›´æ–°å½“å‰é¢‘é“ä¿¡æ¯
            document.getElementById('currentChannelName').textContent = channel.name;
            document.getElementById('currentChannelGroup').textContent = `${channel.group} Â· å½“å‰æ­£åœ¨æ’­æ”¾`;
            document.getElementById('currentChannelGroup').classList.remove('test-indicator');
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            const loadingOverlay = document.getElementById('loadingOverlay');
            loadingOverlay.classList.remove('hidden');
            loadingOverlay.innerHTML = `
                <div class="loading-spinner"></div>
                <p>æ­£åœ¨åˆ‡æ¢è‡³ ${channel.name}...</p>
            `;
            
            // æ›´æ–°æ’­æ”¾å™¨æº
            player.src = channel.url;
            player.load();
            
            player.play().then(() => {
                console.log(`å¼€å§‹æ’­æ”¾: ${channel.name}`);
                loadingOverlay.classList.add('hidden');
                
                // æ›´æ–°åˆ—è¡¨æ¿€æ´»çŠ¶æ€
                document.querySelectorAll('.channel-item').forEach(item => {
                    item.classList.remove('active');
                });
                
                const activeItems = document.querySelectorAll(`.channel-item[data-index="${currentChannelIndex}"]`);
                activeItems.forEach(item => {
                    item.classList.add('active');
                    
                    // æ»šåŠ¨åˆ°å¯è§åŒºåŸŸ
                    item.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                });
                
                // æ›´æ–°æ¸…æ™°åº¦é€‰æ‹©å™¨
                updateQualitySelector(channel.name, channel.url);
                
            }).catch(error => {
                console.error('æ’­æ”¾å¤±è´¥:', error);
                loadingOverlay.innerHTML = `
                    <div style="text-align: center;">
                        <div style="font-size: 2rem; margin-bottom: 10px;">âš ï¸</div>
                        <h3 style="margin-bottom: 10px;">æ’­æ”¾å¤±è´¥</h3>
                        <p style="margin-bottom: 15px;">${channel.name} ç›´æ’­æºå¯èƒ½æš‚æ—¶ä¸å¯ç”¨</p>
                        <button id="retryBtn" style="background: var(--ghost-accent-color); border: none; color: white; padding: 8px 16px; border-radius: 5px; cursor: pointer;">é‡è¯•</button>
                    </div>
                `;
                
                document.getElementById('retryBtn').addEventListener('click', function() {
                    playChannel(channel, index);
                });
            });
        }
        
        // æ’­æ”¾ä¸Šä¸€ä¸ªé¢‘é“
        function playPrevChannel() {
            if (isPlayingTestVideo && lastPlayedChannel) {
                // å¦‚æœæ­£åœ¨æ’­æ”¾æµ‹è¯•è§†é¢‘ï¼Œè¿”å›ä¸Šä¸€ä¸ªé¢‘é“
                const index = allChannels.findIndex(ch => ch.url === lastPlayedChannel.url);
                if (index !== -1) {
                    playChannel(lastPlayedChannel, index);
                }
                return;
            }
            
            if (allChannels.length === 0) return;
            
            currentChannelIndex = (currentChannelIndex - 1 + allChannels.length) % allChannels.length;
            const channel = allChannels[currentChannelIndex];
            if (channel) {
                playChannel(channel, currentChannelIndex);
            }
        }
        
        // æ’­æ”¾ä¸‹ä¸€ä¸ªé¢‘é“
        function playNextChannel() {
            if (isPlayingTestVideo && lastPlayedChannel) {
                // å¦‚æœæ­£åœ¨æ’­æ”¾æµ‹è¯•è§†é¢‘ï¼Œè¿”å›ä¸Šä¸€ä¸ªé¢‘é“
                const index = allChannels.findIndex(ch => ch.url === lastPlayedChannel.url);
                if (index !== -1) {
                    playChannel(lastPlayedChannel, index);
                }
                return;
            }
            
            if (allChannels.length === 0) return;
            
            currentChannelIndex = (currentChannelIndex + 1) % allChannels.length;
            const channel = allChannels[currentChannelIndex];
            if (channel) {
                playChannel(channel, currentChannelIndex);
            }
        }
        
        // æ’­æ”¾æµ‹è¯•è§†é¢‘
        function playTestVideo(testNum) {
            const testUrl = testNum === 1 ? TEST_VIDEO_URL_1 : TEST_VIDEO_URL_2;
            const testName = testNum === 1 ? "Apple æµ‹è¯•è§†é¢‘" : "Tears of Steel æµ‹è¯•è§†é¢‘";
            
            isPlayingTestVideo = true;
            
            // æ›´æ–°å½“å‰é¢‘é“ä¿¡æ¯
            document.getElementById('currentChannelName').textContent = testName;
            document.getElementById('currentChannelGroup').textContent = `æµ‹è¯•è§†é¢‘${testNum} Â· æ’­æ”¾ä¸­`;
            document.getElementById('currentChannelGroup').classList.add('test-indicator');
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            const loadingOverlay = document.getElementById('loadingOverlay');
            loadingOverlay.classList.remove('hidden');
            loadingOverlay.innerHTML = `
                <div class="loading-spinner"></div>
                <p>æ­£åœ¨åŠ è½½æµ‹è¯•è§†é¢‘${testNum}...</p>
            `;
            
            // æ›´æ–°æ’­æ”¾å™¨æº
            player.src = testUrl;
            player.load();
            
            player.play().then(() => {
                console.log(`å¼€å§‹æ’­æ”¾æµ‹è¯•è§†é¢‘${testNum}`);
                loadingOverlay.classList.add('hidden');
                
                // ç§»é™¤é¢‘é“åˆ—è¡¨çš„æ¿€æ´»çŠ¶æ€
                document.querySelectorAll('.channel-item').forEach(item => {
                    item.classList.remove('active');
                });
                
                // æ›´æ–°æ¸…æ™°åº¦é€‰æ‹©å™¨
                updateQualitySelector(testName, testUrl);
                
            }).catch(error => {
                console.error('æµ‹è¯•è§†é¢‘æ’­æ”¾å¤±è´¥:', error);
                loadingOverlay.innerHTML = `
                    <div style="text-align: center;">
                        <div style="font-size: 2rem; margin-bottom: 10px;">âš ï¸</div>
                        <h3 style="margin-bottom: 10px;">æµ‹è¯•è§†é¢‘${testNum}æ’­æ”¾å¤±è´¥</h3>
                        <p style="margin-bottom: 15px;">æµ‹è¯•è§†é¢‘å¯èƒ½æš‚æ—¶ä¸å¯ç”¨</p>
                        <button id="retryTestBtn" style="background: var(--test-color); border: none; color: white; padding: 8px 16px; border-radius: 5px; cursor: pointer;">é‡è¯•æµ‹è¯•è§†é¢‘</button>
                        ${lastPlayedChannel ? `<button id="backToChannelBtn" style="background: var(--ghost-accent-color); border: none; color: white; padding: 8px 16px; border-radius: 5px; cursor: pointer; margin-left: 10px;">è¿”å›é¢‘é“</button>` : ''}
                    </div>
                `;
                
                document.getElementById('retryTestBtn').addEventListener('click', function() {
                    playTestVideo(testNum);
                });
                
                if (lastPlayedChannel) {
                    document.getElementById('backToChannelBtn').addEventListener('click', function() {
                        const index = allChannels.findIndex(ch => ch.url === lastPlayedChannel.url);
                        if (index !== -1) {
                            playChannel(lastPlayedChannel, index);
                        }
                    });
                }
            });
        }
        
        // æ›´æ–°æ¸…æ™°åº¦é€‰æ‹©å™¨
        function updateQualitySelector(channelName, channelUrl) {
            const qualitySelector = document.getElementById('qualitySelector');
            qualitySelector.innerHTML = '<option value="auto">è‡ªåŠ¨æ¸…æ™°åº¦</option>';
            
            // è¿™é‡Œå¯ä»¥æ·»åŠ æ›´å¤šæ¸…æ™°åº¦é€‰é¡¹
            // å¯¹äºM3U8æµï¼Œé€šå¸¸æœ‰å¤šä¸ªè´¨é‡çº§åˆ«
            // è¿™é‡Œåªæ˜¯ç¤ºä¾‹ï¼Œå®é™…åº”ç”¨ä¸­éœ€è¦è§£æM3U8æ–‡ä»¶æ¥è·å–è´¨é‡çº§åˆ«
            if (channelName.includes("æµ‹è¯•è§†é¢‘")) {
                qualitySelector.innerHTML += `
                    <option value="high">é«˜æ¸… (1080p)</option>
                    <option value="medium">æ ‡æ¸… (720p)</option>
                    <option value="low">æµç•… (480p)</option>
                `;
            }
        }
        
        // åˆå§‹åŒ–æ’­æ”¾å™¨æ§åˆ¶
        function initPlayerControls() {
            const loadingOverlay = document.getElementById('loadingOverlay');
            const customControls = document.getElementById('customControls');
            const progressBar = document.getElementById('progressBar');
            const progressContainer = document.getElementById('progressContainer');
            const progressTime = document.getElementById('progressTime');
            const volumeSlider = document.getElementById('volumeSlider');
            const volumeLevel = document.getElementById('volumeLevel');
            const playIcon = document.getElementById('playIcon');
            
            // è‡ªå®šä¹‰æ’­æ”¾/æš‚åœæŒ‰é’®
            document.getElementById('customPlayBtn').addEventListener('click', () => {
                if (player.paused) {
                    player.play();
                } else {
                    player.pause();
                }
            });
            
            // ä¸Šä¸€ä¸ªé¢‘é“æŒ‰é’®
            document.getElementById('prevBtn').addEventListener('click', () => {
                playPrevChannel();
            });
            
            // ä¸‹ä¸€ä¸ªé¢‘é“æŒ‰é’®
            document.getElementById('nextBtn').addEventListener('click', () => {
                playNextChannel();
            });
            
            // å…¨å±æŒ‰é’®
            document.getElementById('fullscreenBtn').addEventListener('click', () => {
                if (player.requestFullscreen) {
                    player.requestFullscreen();
                } else if (player.webkitRequestFullscreen) {
                    player.webkitRequestFullscreen();
                } else if (player.mozRequestFullScreen) {
                    player.mozRequestFullScreen();
                }
            });
            
            // éŸ³é‡æŒ‰é’®
            document.getElementById('volumeBtn').addEventListener('click', () => {
                player.muted = !player.muted;
                document.getElementById('volumeBtn').textContent = player.muted ? 'ğŸ”‡' : 'ğŸ”Š';
            });
            
            // éŸ³é‡æ»‘å—
            volumeSlider.addEventListener('click', (e) => {
                const rect = volumeSlider.getBoundingClientRect();
                const percent = (e.clientX - rect.left) / rect.width;
                player.volume = Math.max(0, Math.min(1, percent));
                updateVolumeDisplay();
            });
            
            // æµ‹è¯•è§†é¢‘1æŒ‰é’®
            document.getElementById('testBtn1').addEventListener('click', () => {
                playTestVideo(1);
            });
            
            // æµ‹è¯•è§†é¢‘2æŒ‰é’®
            document.getElementById('testBtn2').addEventListener('click', () => {
                playTestVideo(2);
            });
            
            // æ¸…æ™°åº¦é€‰æ‹©å™¨
            document.getElementById('qualitySelector').addEventListener('change', function() {
                // è¿™é‡Œå¯ä»¥æ·»åŠ åˆ‡æ¢æ¸…æ™°åº¦çš„é€»è¾‘
                console.log('åˆ‡æ¢åˆ°æ¸…æ™°åº¦:', this.value);
            });
            
            // æ’­æ”¾å™¨äº‹ä»¶
            player.addEventListener('play', () => {
                playIcon.textContent = 'âšâš';
            });
            
            player.addEventListener('pause', () => {
                playIcon.textContent = 'â–¶';
            });
            
            player.addEventListener('loadeddata', () => {
                loadingOverlay.classList.add('hidden');
            });
            
            player.addEventListener('waiting', () => {
                loadingOverlay.classList.remove('hidden');
                loadingOverlay.innerHTML = `<div class="loading-spinner"></div><p>æ­£åœ¨ç¼“å†²...</p>`;
            });
            
            player.addEventListener('canplay', () => {
                loadingOverlay.classList.add('hidden');
            });
            
            player.addEventListener('timeupdate', () => {
                if (player.duration) {
                    const percent = (player.currentTime / player.duration) * 100;
                    progressBar.style.width = percent + '%';
                }
            });
            
            player.addEventListener('volumechange', () => {
                updateVolumeDisplay();
            });
            
            // è¿›åº¦æ¡ç‚¹å‡»
            progressContainer.addEventListener('click', (e) => {
                const rect = progressContainer.getBoundingClientRect();
                const percent = (e.clientX - rect.left) / rect.width;
                player.currentTime = percent * player.duration;
            });
            
            // è¿›åº¦æ¡æ‚¬åœæ˜¾ç¤ºæ—¶é—´
            progressContainer.addEventListener('mousemove', (e) => {
                const rect = progressContainer.getBoundingClientRect();
                const percent = (e.clientX - rect.left) / rect.width;
                const time = percent * (player.duration || 0);
                
                const minutes = Math.floor(time / 60);
                const seconds = Math.floor(time % 60);
                progressTime.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                const progressTimeEl = document.getElementById('progressTime');
                progressTimeEl.style.left = `${percent * 100}%`;
            });
            
            // æ§åˆ¶æ¡æ˜¾ç¤º/éšè—
            player.addEventListener('mousemove', () => {
                customControls.style.opacity = '1';
                if (controlsHideTimeout) clearTimeout(controlsHideTimeout);
                
                controlsHideTimeout = setTimeout(() => {
                    customControls.style.opacity = '0';
                }, 3000);
            });
            
            customControls.addEventListener('mousemove', () => {
                customControls.style.opacity = '1';
                if (controlsHideTimeout) clearTimeout(controlsHideTimeout);
            });
            
            player.addEventListener('mouseleave', () => {
                controlsHideTimeout = setTimeout(() => {
                    customControls.style.opacity = '0';
                }, 1000);
            });
            
            player.addEventListener('error', (e) => {
                console.error('æ’­æ”¾å™¨é”™è¯¯:', e);
                loadingOverlay.innerHTML = `
                    <div style="text-align: center;">
                        <div style="font-size: 2rem; margin-bottom: 10px;">âš ï¸</div>
                        <h3 style="margin-bottom: 10px;">æ’­æ”¾é”™è¯¯</h3>
                        <p style="margin-bottom: 15px;">è§†é¢‘æµåŠ è½½å¤±è´¥</p>
                        ${isPlayingTestVideo ? 
                            `<button id="retryCurrentBtn" style="background: var(--test-color); border: none; color: white; padding: 8px 16px; border-radius: 5px; cursor: pointer;">é‡è¯•æµ‹è¯•è§†é¢‘</button>
                             ${lastPlayedChannel ? `<button id="backToChannelBtn2" style="background: var(--ghost-accent-color); border: none; color: white; padding: 8px 16px; border-radius: 5px; cursor: pointer; margin-left: 10px;">è¿”å›é¢‘é“</button>` : ''}` 
                            : 
                            `<button id="retryCurrentBtn" style="background: var(--ghost-accent-color); border: none; color: white; padding: 8px 16px; border-radius: 5px; cursor: pointer;">é‡è¯•å½“å‰é¢‘é“</button>`
                        }
                    </div>
                `;
                
                document.getElementById('retryCurrentBtn').addEventListener('click', function() {
                    if (isPlayingTestVideo) {
                        const testNum = player.src.includes('apple.com') ? 1 : 2;
                        playTestVideo(testNum);
                    } else if (allChannels[currentChannelIndex]) {
                        playChannel(allChannels[currentChannelIndex], currentChannelIndex);
                    }
                });
                
                if (isPlayingTestVideo && lastPlayedChannel) {
                    document.getElementById('backToChannelBtn2').addEventListener('click', function() {
                        const index = allChannels.findIndex(ch => ch.url === lastPlayedChannel.url);
                        if (index !== -1) {
                            playChannel(lastPlayedChannel, index);
                        }
                    });
                }
            });
            
            // é”®ç›˜å¿«æ·é”®
            document.addEventListener('keydown', (e) => {
                if (e.code === 'Space' && !e.target.matches('input, textarea, select')) {
                    e.preventDefault();
                    if (player.paused) player.play();
                    else player.pause();
                }
                
                if (e.code === 'KeyF' && !e.target.matches('input, textarea, select')) {
                    e.preventDefault();
                    if (document.fullscreenElement) document.exitFullscreen();
                    else if (player.requestFullscreen) player.requestFullscreen();
                }
                
                // å·¦å³ç®­å¤´åˆ‡æ¢é¢‘é“
                if (e.code === 'ArrowLeft' && !e.target.matches('input, textarea, select')) {
                    e.preventDefault();
                    playPrevChannel();
                }
                
                if (e.code === 'ArrowRight' && !e.target.matches('input, textarea, select')) {
                    e.preventDefault();
                    playNextChannel();
                }
                
                // Té”®åˆ‡æ¢æµ‹è¯•è§†é¢‘
                if (e.code === 'Digit1' && !e.target.matches('input, textarea, select') && e.ctrlKey) {
                    e.preventDefault();
                    playTestVideo(1);
                }
                
                if (e.code === 'Digit2' && !e.target.matches('input, textarea, select') && e.ctrlKey) {
                    e.preventDefault();
                    playTestVideo(2);
                }
                
                // Mé”®é™éŸ³
                if (e.code === 'KeyM' && !e.target.matches('input, textarea, select')) {
                    e.preventDefault();
                    player.muted = !player.muted;
                    document.getElementById('volumeBtn').textContent = player.muted ? 'ğŸ”‡' : 'ğŸ”Š';
                }
            });
            
            // åˆå§‹åŒ–éŸ³é‡æ˜¾ç¤º
            function updateVolumeDisplay() {
                const volume = player.muted ? 0 : player.volume;
                volumeLevel.style.width = `${volume * 100}%`;
                document.getElementById('volumeBtn').textContent = volume === 0 ? 'ğŸ”‡' : 'ğŸ”Š';
            }
            
            updateVolumeDisplay();
        }
    </script>
</body>
</html>
