<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ¨çº¿ç”µå°æ’­æ”¾å™¨ - zhrçš„åšå®¢</title>
    <style>
        :root {
            --primary-color: #59c090;
            --primary-dark: #4aad7a;
            --text-color: #333;
            --text-light: #666;
            --bg-color: #fff;
            --bg-light: #f9f9f9;
            --border-color: #eaeaea;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --radius: 12px;
            --radius-sm: 8px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Noto Sans SC', sans-serif;
        }
        
        body {
            background-color: var(--bg-light);
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1000px;
            width: 100%;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 2.2rem;
        }
        
        .subtitle {
            color: var(--text-light);
            font-size: 1.1rem;
            margin-bottom: 20px;
        }
        
        .player-container {
            background: var(--bg-color);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            margin-bottom: 40px;
            border: 1px solid var(--border-color);
        }
        
        /* æ’­æ”¾å™¨å¤´éƒ¨ */
        .player-header {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .player-title {
            font-size: 1.6rem;
            font-weight: 600;
        }
        
        .player-subtitle {
            font-size: 0.95rem;
            opacity: 0.9;
            margin-top: 5px;
        }
        
        .live-badge {
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            font-weight: 500;
        }
        
        .live-dot {
            width: 8px;
            height: 8px;
            background: #ff5a5a;
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        /* æ’­æ”¾å™¨ä¸»ä½“ - æ–°å¸ƒå±€ */
        .player-main {
            padding: 30px;
        }
        
        /* å½“å‰æ’­æ”¾ç”µå° - æ–°å¸ƒå±€ */
        .current-station {
            display: flex;
            align-items: stretch;
            gap: 30px;
            padding: 25px;
            background: var(--bg-light);
            border-radius: var(--radius-sm);
            margin-bottom: 30px;
            border: 1px solid var(--border-color);
            min-height: 220px;
        }
        
        .station-cover {
            width: 200px;
            height: 200px;
            border-radius: var(--radius-sm);
            overflow: hidden;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
            flex-shrink: 0;
        }
        
        .station-cover img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .station-info {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .station-name {
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-color);
            line-height: 1.3;
        }
        
        .station-meta {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 20px;
        }
        
        .station-group, .station-country, .station-language {
            color: var(--text-light);
            font-size: 1rem;
            display: flex;
            align-items: center;
        }
        
        .station-group:before {
            content: "ğŸ“»";
            margin-right: 8px;
            font-size: 0.9rem;
        }
        
        .station-country:before {
            content: "ğŸ“";
            margin-right: 8px;
            font-size: 0.9rem;
        }
        
        .station-language:before {
            content: "ğŸ—£ï¸";
            margin-right: 8px;
            font-size: 0.9rem;
        }
        
        .station-description {
            color: var(--text-light);
            font-size: 0.95rem;
            line-height: 1.5;
            margin-top: 10px;
            flex: 1;
        }
        
        /* æ’­æ”¾æ§åˆ¶åŒºåŸŸ - æ–°å¸ƒå±€ */
        .player-controls {
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            height: 100%;
        }
        
        .control-buttons {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .control-btn {
            background: var(--primary-color);
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            font-size: 1.3rem;
            box-shadow: 0 4px 10px rgba(89, 192, 144, 0.3);
        }
        
        .control-btn:hover {
            background: var(--primary-dark);
            transform: scale(1.05);
        }
        
        .play-pause-btn {
            width: 60px;
            height: 60px;
            font-size: 1.5rem;
        }
        
        .play-pause-btn.playing .play-icon {
            display: none;
        }
        
        .play-pause-btn.playing .pause-icon {
            display: block;
        }
        
        .play-pause-btn .pause-icon {
            display: none;
        }
        
        .control-volume {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 10px;
        }
        
        .volume-icon {
            color: var(--text-light);
            font-size: 1.3rem;
            width: 24px;
        }
        
        .volume-slider {
            flex: 1;
            height: 6px;
            background: #e0e0e0;
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
        }
        
        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        
        .player-status {
            text-align: left;
            font-style: italic;
            color: var(--text-light);
            font-size: 0.9rem;
            height: 22px;
            margin-top: 10px;
        }
        
        /* ç”µå°åˆ—è¡¨åŒºåŸŸ */
        .stations-section {
            margin-top: 20px;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .section-title {
            font-size: 1.4rem;
            color: #444;
        }
        
        .stations-count {
            color: var(--primary-dark);
            font-weight: 500;
            background: rgba(89, 192, 144, 0.1);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
        }
        
        /* åˆ†ç»„ç”µå°åˆ—è¡¨ */
        .stations-by-group {
            margin-bottom: 30px;
        }
        
        .group-title {
            font-size: 1.1rem;
            color: #555;
            margin-bottom: 15px;
            padding-left: 10px;
            border-left: 4px solid var(--primary-color);
        }
        
        .stations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .station-card {
            background: var(--bg-light);
            border-radius: var(--radius-sm);
            padding: 18px;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid transparent;
            display: flex;
            flex-direction: column;
        }
        
        .station-card:hover {
            background: #e8f5ee;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border-color: var(--primary-color);
        }
        
        .station-card.active {
            background: #e8f5ee;
            border-color: var(--primary-color);
        }
        
        .station-card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .station-card-logo {
            width: 50px;
            height: 50px;
            border-radius: 8px;
            overflow: hidden;
            flex-shrink: 0;
        }
        
        .station-card-logo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .station-card-name {
            font-weight: 600;
            font-size: 1rem;
            color: var(--text-color);
        }
        
        .station-card-info {
            margin-top: 8px;
        }
        
        .station-card-country, .station-card-language {
            font-size: 0.8rem;
            color: var(--text-light);
            margin-bottom: 3px;
        }
        
        /* æ’­æ”¾å™¨åº•éƒ¨ */
        .player-footer {
            background: var(--bg-light);
            padding: 20px 30px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
            color: var(--text-light);
        }
        
        .footer-info {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .current-station {
                flex-direction: column;
                gap: 20px;
                min-height: auto;
            }
            
            .station-cover {
                width: 180px;
                height: 180px;
                align-self: center;
            }
            
            .player-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .player-controls {
                justify-content: flex-start;
                height: auto;
            }
            
            .stations-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .player-footer {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .footer-info {
                flex-direction: column;
                gap: 8px;
            }
        }
        
        @media (max-width: 480px) {
            .stations-grid {
                grid-template-columns: 1fr;
            }
            
            .player-main {
                padding: 20px;
            }
            
            .control-buttons {
                gap: 10px;
            }
            
            .control-btn {
                width: 45px;
                height: 45px;
            }
            
            .play-pause-btn {
                width: 55px;
                height: 55px;
            }
            
            .current-station {
                padding: 20px;
            }
        }
        
        /* åŠ è½½çŠ¶æ€ */
        .loading-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
            text-align: center;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(89, 192, 144, 0.3);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error-message {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: var(--radius-sm);
            margin: 20px 0;
            text-align: center;
            border-left: 4px solid #c62828;
        }
        
        /* å·¥å…·ç±» */
        .hidden {
            display: none !important;
        }
        
        .text-center {
            text-align: center;
        }
        
        .mt-20 {
            margin-top: 20px;
        }
        
        .mb-20 {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ“» åœ¨çº¿ç”µå°æ’­æ”¾å™¨</h1>
            <p class="subtitle">åŸºäºM3Uæ’­æ”¾åˆ—è¡¨çš„åŠ¨æ€ç”µå°æ’­æ”¾å™¨</p>
        </header>
        
        <div class="player-container">
            <!-- æ’­æ”¾å™¨å¤´éƒ¨ -->
            <div class="player-header">
                <div>
                    <h2 class="player-title">ç”µå°æ’­æ”¾å™¨</h2>
                    <p class="player-subtitle">æ­£åœ¨åŠ è½½æ’­æ”¾åˆ—è¡¨...</p>
                </div>
                <div class="live-badge">
                    <span class="live-dot"></span>
                    <span>ç›´æ’­ä¸­</span>
                </div>
            </div>
            
            <!-- æ’­æ”¾å™¨ä¸»ä½“ -->
            <div class="player-main">
                <!-- åŠ è½½çŠ¶æ€ -->
                <div id="loadingContainer" class="loading-container">
                    <div class="spinner"></div>
                    <p>æ­£åœ¨åŠ è½½ç”µå°åˆ—è¡¨...</p>
                </div>
                
                <!-- é”™è¯¯æç¤º -->
                <div id="errorContainer" class="error-message hidden">
                    <p id="errorMessage"></p>
                </div>
                
                <!-- å½“å‰æ’­æ”¾ç”µå° - æ–°å¸ƒå±€ -->
                <div id="currentStationContainer" class="current-station hidden">
                    <div class="station-cover">
                        <img id="currentStationLogo" src="" alt="ç”µå°Logo">
                    </div>
                    <div class="station-info">
                        <h3 class="station-name" id="currentStationName">ç”µå°åç§°</h3>
                        <div class="station-meta">
                            <div class="station-group" id="currentStationGroup">ç”µå°åˆ†ç±»</div>
                            <div class="station-language" id="currentStationLanguage">è¯­è¨€</div>
                            <div class="station-country" id="currentStationCountry">å›½å®¶</div>
                        </div>
                        <p class="station-description" id="currentStationDescription">ç”µå°æè¿°ä¿¡æ¯</p>
                        
                        <!-- æ’­æ”¾æ§åˆ¶åŒºåŸŸ - æ–°å¸ƒå±€ -->
                        <div class="player-controls">
                            <div class="control-buttons">
                                <button class="control-btn" id="prevBtn" title="ä¸Šä¸€ä¸ªç”µå°">â®</button>
                                <button class="control-btn play-pause-btn" id="playPauseBtn" title="æ’­æ”¾/æš‚åœ">
                                    <span class="play-icon">â–¶</span>
                                    <span class="pause-icon">âšâš</span>
                                </button>
                                <button class="control-btn" id="nextBtn" title="ä¸‹ä¸€ä¸ªç”µå°">â­</button>
                            </div>
                            
                            <div class="control-volume">
                                <span class="volume-icon" id="volumeIcon">ğŸ”Š</span>
                                <input type="range" class="volume-slider" id="volumeSlider" min="0" max="1" step="0.01" value="0.5">
                            </div>
                            
                            <div class="player-status" id="playerStatus">å‡†å¤‡å°±ç»ªï¼Œè¯·é€‰æ‹©ä¸€ä¸ªç”µå°å¼€å§‹æ’­æ”¾</div>
                        </div>
                    </div>
                </div>
                
                <!-- ç”µå°åˆ—è¡¨åŒºåŸŸ -->
                <div id="stationsContainer" class="stations-section hidden">
                    <div class="section-header">
                        <h3 class="section-title">ç”µå°åˆ—è¡¨</h3>
                        <div class="stations-count" id="stationsCount">0ä¸ªç”µå°</div>
                    </div>
                    
                    <!-- æŒ‰åˆ†ç»„æ˜¾ç¤ºçš„ç”µå°åˆ—è¡¨ -->
                    <div id="stationsByGroup"></div>
                </div>
            </div>
            
            <!-- æ’­æ”¾å™¨åº•éƒ¨ -->
            <div class="player-footer">
                <div class="footer-info">
                    <div>æ’­æ”¾åˆ—è¡¨æ¥æº: <a href="https://raw.bgithub.xyz/zhr-0731/IPTV-m3u/refs/heads/main/radio.m3u" target="_blank" id="playlistSource">radio.m3u</a></div>
                    <div>éŸ³é¢‘æ ¼å¼: <span id="currentAudioFormat">HLS</span></div>
                </div>
                <div>æœ€åæ›´æ–°: <span id="updateTime">-</span></div>
            </div>
        </div>
        
        <div class="text-center mt-20">
            <p>æ­¤æ’­æ”¾å™¨åŠ¨æ€åŠ è½½å¹¶è§£æM3Uæ’­æ”¾åˆ—è¡¨ï¼Œè‡ªåŠ¨æŒ‰åˆ†ç»„æ˜¾ç¤ºç”µå°ã€‚</p>
            <p class="text-light">åŸºäºæ‚¨çš„æ’­æ”¾åˆ—è¡¨: https://raw.bgithub.xyz/zhr-0731/IPTV-m3u/refs/heads/main/radio.m3u</p>
        </div>
    </div>
    
    <!-- éŸ³é¢‘å…ƒç´  -->
    <audio id="radioPlayer" preload="metadata" crossorigin="anonymous">
        æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾
    </audio>

    <script>
        // M3Uæ’­æ”¾åˆ—è¡¨URL
        const M3U_PLAYLIST_URL = 'https://raw.bgithub.xyz/zhr-0731/IPTV-m3u/refs/heads/main/radio.m3u';
        
        // DOMå…ƒç´ 
        const radioPlayer = document.getElementById('radioPlayer');
        const playPauseBtn = document.getElementById('playPauseBtn');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const volumeSlider = document.getElementById('volumeSlider');
        const volumeIcon = document.getElementById('volumeIcon');
        const playerStatus = document.getElementById('playerStatus');
        const loadingContainer = document.getElementById('loadingContainer');
        const errorContainer = document.getElementById('errorContainer');
        const errorMessage = document.getElementById('errorMessage');
        const currentStationContainer = document.getElementById('currentStationContainer');
        const stationsContainer = document.getElementById('stationsContainer');
        const stationsCount = document.getElementById('stationsCount');
        const stationsByGroup = document.getElementById('stationsByGroup');
        const updateTime = document.getElementById('updateTime');
        const playlistSource = document.getElementById('playlistSource');
        
        // å½“å‰æ’­æ”¾çš„ç”µå°ä¿¡æ¯
        let currentStation = null;
        let stations = [];
        let stationGroups = {};
        let currentStationIndex = 0;
        
        // é»˜è®¤ç”µå°Logoï¼ˆå½“ç”µå°æ²¡æœ‰æä¾›Logoæ—¶ä½¿ç”¨ï¼‰
        const DEFAULT_LOGO = 'https://img.zcool.cn/community/01b4515c34c499a801208f8c1365ee.jpg';
        
        // åˆå§‹åŒ–æ’­æ”¾å™¨
        async function initPlayer() {
            try {
                console.log('å¼€å§‹åŠ è½½M3Uæ’­æ”¾åˆ—è¡¨...');
                playerStatus.textContent = 'æ­£åœ¨åŠ è½½æ’­æ”¾åˆ—è¡¨...';
                
                // åŠ è½½M3Uæ’­æ”¾åˆ—è¡¨
                const response = await fetch(M3U_PLAYLIST_URL);
                
                if (!response.ok) {
                    throw new Error(`æ— æ³•åŠ è½½æ’­æ”¾åˆ—è¡¨: ${response.status} ${response.statusText}`);
                }
                
                const m3uContent = await response.text();
                
                // è§£æM3Uå†…å®¹
                stations = parseM3U(m3uContent);
                
                if (stations.length === 0) {
                    throw new Error('æ’­æ”¾åˆ—è¡¨ä¸ºç©ºæˆ–æ ¼å¼ä¸æ­£ç¡®');
                }
                
                console.log(`æˆåŠŸåŠ è½½ ${stations.length} ä¸ªç”µå°`);
                
                // æŒ‰åˆ†ç»„ç»„ç»‡ç”µå°
                organizeStationsByGroup();
                
                // æ›´æ–°UI
                updateStationsCount();
                renderStationsByGroup();
                
                // è®¾ç½®ç¬¬ä¸€ä¸ªç”µå°ä¸ºå½“å‰ç”µå°
                if (stations.length > 0) {
                    currentStationIndex = 0;
                    setCurrentStation(stations[0]);
                }
                
                // éšè—åŠ è½½çŠ¶æ€ï¼Œæ˜¾ç¤ºå†…å®¹
                loadingContainer.classList.add('hidden');
                currentStationContainer.classList.remove('hidden');
                stationsContainer.classList.remove('hidden');
                
                // åˆå§‹åŒ–æ’­æ”¾å™¨æ§åˆ¶
                initPlayerControls();
                
                // æ›´æ–°æ’­æ”¾å™¨å‰¯æ ‡é¢˜
                document.querySelector('.player-subtitle').textContent = `${stations.length}ä¸ªç”µå°ï¼Œ${Object.keys(stationGroups).length}ä¸ªåˆ†ç»„`;
                
                // æ›´æ–°æ—¶é—´
                updateTime.textContent = new Date().toLocaleString('zh-CN', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
            } catch (error) {
                console.error('åˆå§‹åŒ–æ’­æ”¾å™¨æ—¶å‡ºé”™:', error);
                showError(`åŠ è½½æ’­æ”¾åˆ—è¡¨å¤±è´¥: ${error.message}`);
            }
        }
        
        // è§£æM3Uå†…å®¹
        function parseM3U(m3uContent) {
            const stations = [];
            const lines = m3uContent.split('\n');
            
            let currentStation = null;
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                
                if (line.startsWith('#EXTINF:')) {
                    // è§£æEXTINFè¡Œ
                    currentStation = parseExtinfLine(line);
                } else if (line && !line.startsWith('#') && currentStation) {
                    // è¿™æ˜¯URLè¡Œï¼Œä¸”å‰é¢æœ‰EXTINFè¡Œ
                    currentStation.streamUrl = line;
                    stations.push(currentStation);
                    currentStation = null;
                }
            }
            
            return stations;
        }
        
        // è§£æEXTINFè¡Œ
        function parseExtinfLine(line) {
            const station = {
                id: generateId(),
                name: 'æœªçŸ¥ç”µå°',
                streamUrl: '',
                group: 'æœªåˆ†ç»„',
                country: 'æœªçŸ¥',
                language: 'æœªçŸ¥',
                logo: DEFAULT_LOGO,
                tvgId: '',
                tvgName: ''
            };
            
            // æå–å±æ€§
            const attrMatch = line.match(/#EXTINF:(-?\d+)\s*(.*)/);
            if (attrMatch) {
                const attributes = attrMatch[2];
                
                // è§£ætvg-id
                const tvgIdMatch = attributes.match(/tvg-id="([^"]*)"/);
                if (tvgIdMatch) station.tvgId = tvgIdMatch[1];
                
                // è§£ætvg-name
                const tvgNameMatch = attributes.match(/tvg-name="([^"]*)"/);
                if (tvgNameMatch) station.tvgName = tvgNameMatch[1];
                
                // è§£ætvg-country
                const tvgCountryMatch = attributes.match(/tvg-country="([^"]*)"/);
                if (tvgCountryMatch) station.country = tvgCountryMatch[1];
                
                // è§£ætvg-language
                const tvgLanguageMatch = attributes.match(/tvg-language="([^"]*)"/);
                if (tvgLanguageMatch) station.language = tvgLanguageMatch[1];
                
                // è§£ætvg-logo
                const tvgLogoMatch = attributes.match(/tvg-logo="([^"]*)"/);
                if (tvgLogoMatch) station.logo = tvgLogoMatch[1];
                
                // è§£ægroup-title
                const groupTitleMatch = attributes.match(/group-title="([^"]*)"/);
                if (groupTitleMatch) station.group = groupTitleMatch[1];
                
                // è§£æç”µå°åç§°ï¼ˆåœ¨å±æ€§ä¹‹åï¼Œé€—å·ä¹‹åçš„éƒ¨åˆ†ï¼‰
                const nameMatch = attributes.match(/,(.*)$/);
                if (nameMatch) station.name = nameMatch[1].trim();
                
                // å¦‚æœtvg-nameå­˜åœ¨ä¸”ä¸ä¸ºç©ºï¼Œä¼˜å…ˆä½¿ç”¨tvg-nameä½œä¸ºç”µå°åç§°
                if (station.tvgName && station.tvgName.trim() !== '') {
                    station.name = station.tvgName;
                }
            }
            
            return station;
        }
        
        // ç”Ÿæˆå”¯ä¸€ID
        function generateId() {
            return 'station-' + Math.random().toString(36).substr(2, 9);
        }
        
        // æŒ‰åˆ†ç»„ç»„ç»‡ç”µå°
        function organizeStationsByGroup() {
            stationGroups = {};
            
            stations.forEach(station => {
                const group = station.group || 'æœªåˆ†ç»„';
                
                if (!stationGroups[group]) {
                    stationGroups[group] = [];
                }
                
                stationGroups[group].push(station);
            });
        }
        
        // æ¸²æŸ“æŒ‰åˆ†ç»„çš„ç”µå°åˆ—è¡¨
        function renderStationsByGroup() {
            stationsByGroup.innerHTML = '';
            
            // æŒ‰åˆ†ç»„åç§°æ’åº
            const sortedGroups = Object.keys(stationGroups).sort();
            
            sortedGroups.forEach(group => {
                const groupContainer = document.createElement('div');
                groupContainer.className = 'stations-by-group';
                
                const groupTitle = document.createElement('h4');
                groupTitle.className = 'group-title';
                groupTitle.textContent = `${group} (${stationGroups[group].length})`;
                
                const stationsGrid = document.createElement('div');
                stationsGrid.className = 'stations-grid';
                
                // ä¸ºè¯¥åˆ†ç»„å†…çš„ç”µå°æ’åº
                const sortedStations = stationGroups[group].sort((a, b) => 
                    a.name.localeCompare(b.name, 'zh-CN')
                );
                
                sortedStations.forEach(station => {
                    const stationCard = createStationCard(station);
                    stationsGrid.appendChild(stationCard);
                });
                
                groupContainer.appendChild(groupTitle);
                groupContainer.appendChild(stationsGrid);
                stationsByGroup.appendChild(groupContainer);
            });
        }
        
        // åˆ›å»ºç”µå°å¡ç‰‡
        function createStationCard(station) {
            const card = document.createElement('div');
            card.className = 'station-card';
            card.id = station.id;
            
            if (currentStation && currentStation.id === station.id) {
                card.classList.add('active');
            }
            
            card.innerHTML = `
                <div class="station-card-header">
                    <div class="station-card-logo">
                        <img src="${station.logo}" alt="${station.name}" onerror="this.src='${DEFAULT_LOGO}'">
                    </div>
                    <div class="station-card-name">${station.name}</div>
                </div>
                <div class="station-card-info">
                    <div class="station-card-country">${station.country}</div>
                    <div class="station-card-language">${station.language}</div>
                </div>
            `;
            
            card.addEventListener('click', () => {
                // æ‰¾åˆ°å½“å‰ç”µå°çš„ç´¢å¼•
                const index = stations.findIndex(s => s.id === station.id);
                if (index !== -1) {
                    currentStationIndex = index;
                }
                setCurrentStation(station);
                // æ›´æ–°æ‰€æœ‰å¡ç‰‡çš„æ¿€æ´»çŠ¶æ€
                document.querySelectorAll('.station-card').forEach(c => {
                    c.classList.remove('active');
                });
                card.classList.add('active');
            });
            
            return card;
        }
        
        // è®¾ç½®å½“å‰ç”µå°
        function setCurrentStation(station) {
            currentStation = station;
            
            // æ›´æ–°å½“å‰ç”µå°æ˜¾ç¤º
            document.getElementById('currentStationName').textContent = station.name;
            document.getElementById('currentStationGroup').textContent = station.group;
            document.getElementById('currentStationCountry').textContent = station.country;
            document.getElementById('currentStationLanguage').textContent = station.language;
            
            const logoImg = document.getElementById('currentStationLogo');
            logoImg.src = station.logo;
            logoImg.alt = station.name;
            logoImg.onerror = function() {
                this.src = DEFAULT_LOGO;
            };
            
            // è®¾ç½®ç”µå°æè¿°
            const description = station.tvgId ? 
                `${station.name} - ${station.group}ç”µå°` : 
                `${station.name}ç”µå°ï¼Œè¯­è¨€: ${station.language}`;
            document.getElementById('currentStationDescription').textContent = description;
            
            // è®¾ç½®éŸ³é¢‘æº
            radioPlayer.src = station.streamUrl;
            
            // æ›´æ–°æ’­æ”¾çŠ¶æ€
            playerStatus.textContent = `å·²é€‰æ‹©: ${station.name}`;
            
            // æ›´æ–°éŸ³é¢‘æ ¼å¼æ˜¾ç¤º
            const isHLS = station.streamUrl.includes('.m3u8');
            document.getElementById('currentAudioFormat').textContent = isHLS ? 'HLS' : 'MP3/å…¶ä»–';
            
            // å¦‚æœä¹‹å‰æ­£åœ¨æ’­æ”¾ï¼Œåˆ‡æ¢åˆ°æ–°ç”µå°å¹¶ç»§ç»­æ’­æ”¾
            if (!radioPlayer.paused) {
                const playPromise = radioPlayer.play();
                if (playPromise !== undefined) {
                    playPromise.then(() => {
                        playerStatus.textContent = `æ­£åœ¨æ’­æ”¾: ${station.name}`;
                    }).catch(error => {
                        console.error('æ’­æ”¾å¤±è´¥:', error);
                        playerStatus.textContent = `æ’­æ”¾å¤±è´¥: ${station.name}`;
                    });
                }
            }
        }
        
        // åˆå§‹åŒ–æ’­æ”¾å™¨æ§åˆ¶
        function initPlayerControls() {
            // è®¾ç½®åˆå§‹éŸ³é‡
            radioPlayer.volume = volumeSlider.value;
            updateVolumeIcon(volumeSlider.value);
            
            // æ’­æ”¾/æš‚åœæŒ‰é’®äº‹ä»¶
            playPauseBtn.addEventListener('click', togglePlayback);
            
            // ä¸Šä¸€ä¸ªç”µå°æŒ‰é’®äº‹ä»¶
            prevBtn.addEventListener('click', playPrevStation);
            
            // ä¸‹ä¸€ä¸ªç”µå°æŒ‰é’®äº‹ä»¶
            nextBtn.addEventListener('click', playNextStation);
            
            // éŸ³é‡æ§åˆ¶äº‹ä»¶
            volumeSlider.addEventListener('input', function() {
                radioPlayer.volume = this.value;
                updateVolumeIcon(this.value);
            });
            
            // éŸ³é¢‘äº‹ä»¶ç›‘å¬
            radioPlayer.addEventListener('play', function() {
                playPauseBtn.classList.add('playing');
                playerStatus.textContent = `æ­£åœ¨æ’­æ”¾: ${currentStation.name}`;
            });
            
            radioPlayer.addEventListener('pause', function() {
                playPauseBtn.classList.remove('playing');
                playerStatus.textContent = `å·²æš‚åœ: ${currentStation.name}`;
            });
            
            radioPlayer.addEventListener('ended', function() {
                playPauseBtn.classList.remove('playing');
                playerStatus.textContent = `æ’­æ”¾ç»“æŸ: ${currentStation.name}`;
            });
            
            radioPlayer.addEventListener('error', function() {
                console.error('éŸ³é¢‘åŠ è½½å¤±è´¥:', radioPlayer.error);
                playerStatus.textContent = `åŠ è½½å¤±è´¥: ${currentStation.name}ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–åˆ‡æ¢ç”µå°`;
                playPauseBtn.disabled = true;
                setTimeout(() => {
                    playPauseBtn.disabled = false;
                }, 3000);
            });
            
            radioPlayer.addEventListener('loadstart', function() {
                playerStatus.textContent = `æ­£åœ¨åŠ è½½: ${currentStation.name}...`;
            });
            
            radioPlayer.addEventListener('canplay', function() {
                if (radioPlayer.paused) {
                    playerStatus.textContent = `å‡†å¤‡å°±ç»ª: ${currentStation.name}`;
                }
            });
        }
        
        // æ’­æ”¾ä¸Šä¸€ä¸ªç”µå°
        function playPrevStation() {
            if (stations.length === 0) return;
            
            currentStationIndex = (currentStationIndex - 1 + stations.length) % stations.length;
            const prevStation = stations[currentStationIndex];
            setCurrentStation(prevStation);
            
            // æ›´æ–°å¡ç‰‡æ¿€æ´»çŠ¶æ€
            document.querySelectorAll('.station-card').forEach(c => {
                c.classList.remove('active');
                if (c.id === prevStation.id) {
                    c.classList.add('active');
                }
            });
            
            // æ»šåŠ¨åˆ°å½“å‰ç”µå°å¡ç‰‡
            const activeCard = document.getElementById(prevStation.id);
            if (activeCard) {
                activeCard.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
        }
        
        // æ’­æ”¾ä¸‹ä¸€ä¸ªç”µå°
        function playNextStation() {
            if (stations.length === 0) return;
            
            currentStationIndex = (currentStationIndex + 1) % stations.length;
            const nextStation = stations[currentStationIndex];
            setCurrentStation(nextStation);
            
            // æ›´æ–°å¡ç‰‡æ¿€æ´»çŠ¶æ€
            document.querySelectorAll('.station-card').forEach(c => {
                c.classList.remove('active');
                if (c.id === nextStation.id) {
                    c.classList.add('active');
                }
            });
            
            // æ»šåŠ¨åˆ°å½“å‰ç”µå°å¡ç‰‡
            const activeCard = document.getElementById(nextStation.id);
            if (activeCard) {
                activeCard.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
        }
        
        // åˆ‡æ¢æ’­æ”¾/æš‚åœ
        function togglePlayback() {
            if (!currentStation) {
                playerStatus.textContent = 'è¯·å…ˆé€‰æ‹©ä¸€ä¸ªç”µå°';
                return;
            }
            
            if (radioPlayer.paused) {
                const playPromise = radioPlayer.play();
                
                if (playPromise !== undefined) {
                    playPromise.then(() => {
                        playerStatus.textContent = `æ­£åœ¨æ’­æ”¾: ${currentStation.name}`;
                    }).catch(error => {
                        console.error('æ’­æ”¾å¤±è´¥:', error);
                        playerStatus.textContent = `æ’­æ”¾å¤±è´¥: ${currentStation.name}ï¼Œè¯·ç‚¹å‡»é‡è¯•`;
                        alert('æ— æ³•æ’­æ”¾éŸ³é¢‘æµï¼Œå¯èƒ½æ˜¯æµè§ˆå™¨é™åˆ¶æˆ–ç½‘ç»œé—®é¢˜ã€‚è¯·ç¡®ä¿æµè§ˆå™¨å…è®¸è‡ªåŠ¨æ’­æ”¾ã€‚');
                    });
                }
            } else {
                radioPlayer.pause();
                playerStatus.textContent = `å·²æš‚åœ: ${currentStation.name}`;
            }
        }
        
        // æ›´æ–°éŸ³é‡å›¾æ ‡
        function updateVolumeIcon(volume) {
            if (volume == 0) {
                volumeIcon.textContent = 'ğŸ”‡';
            } else if (volume < 0.5) {
                volumeIcon.textContent = 'ğŸ”‰';
            } else {
                volumeIcon.textContent = 'ğŸ”Š';
            }
        }
        
        // æ›´æ–°ç”µå°æ•°é‡æ˜¾ç¤º
        function updateStationsCount() {
            stationsCount.textContent = `${stations.length}ä¸ªç”µå°`;
        }
        
        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        function showError(message) {
            errorMessage.textContent = message;
            errorContainer.classList.remove('hidden');
            loadingContainer.classList.add('hidden');
            
            // æ·»åŠ é‡è¯•æŒ‰é’®
            const retryButton = document.createElement('button');
            retryButton.textContent = 'é‡è¯•';
            retryButton.style.cssText = `
                background: var(--primary-color);
                color: white;
                border: none;
                padding: 8px 16px;
                border-radius: 4px;
                margin-top: 10px;
                cursor: pointer;
            `;
            retryButton.addEventListener('click', () => {
                errorContainer.classList.add('hidden');
                loadingContainer.classList.remove('hidden');
                initPlayer();
            });
            
            errorMessage.appendChild(document.createElement('br'));
            errorMessage.appendChild(retryButton);
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–æ’­æ”¾å™¨
        document.addEventListener('DOMContentLoaded', initPlayer);
    </script>
</body>
</html>
